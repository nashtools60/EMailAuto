<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Automation Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“§ Email Automation Dashboard</h1>
            <p class="subtitle">AI-powered email processing with human oversight</p>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="showTab('drafts')">Review Drafts</button>
            <button class="tab-btn" onclick="showTab('accounts')">Email Accounts</button>
            <button class="tab-btn" onclick="showTab('config')">Configuration</button>
            <button class="tab-btn" onclick="showTab('actions')">Actions</button>
            <button class="tab-btn" onclick="showTab('templates')">Templates</button>
            <button class="tab-btn" onclick="showTab('settings')">Settings</button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Pending Drafts</h3>
                    <div class="stat-value" id="stat-pending">-</div>
                </div>
                <div class="stat-card">
                    <h3>Approved</h3>
                    <div class="stat-value" id="stat-approved">-</div>
                </div>
                <div class="stat-card">
                    <h3>Total Processed</h3>
                    <div class="stat-value" id="stat-total">-</div>
                </div>
            </div>

            <div class="action-section">
                <button onclick="processEmails()" class="btn btn-primary">Process New Emails</button>
                <span id="process-status"></span>
            </div>

            <div class="card">
                <div class="summary-header-row">
                    <h2>Email Summaries by Priority</h2>
                    <div class="summary-filter">
                        <label for="summary-mailbox-filter">Mailbox:</label>
                        <select id="summary-mailbox-filter" onchange="loadEmailSummaries()">
                            <option value="">All Mailboxes</option>
                        </select>
                    </div>
                </div>
                <div id="email-summaries">
                    <div class="summary-section">
                        <button class="summary-header high-priority" onclick="toggleSummary('high-priority-emails')">
                            <span class="summary-title">ðŸ”´ High Priority Emails</span>
                            <span class="summary-count" id="high-priority-count">0</span>
                            <span class="expand-icon">â–¼</span>
                        </button>
                        <div id="high-priority-emails" class="summary-content" style="display: none;"></div>
                    </div>

                    <div class="summary-section">
                        <button class="summary-header important" onclick="toggleSummary('important-emails')">
                            <span class="summary-title">ðŸŸ  Important Emails</span>
                            <span class="summary-count" id="important-count">0</span>
                            <span class="expand-icon">â–¼</span>
                        </button>
                        <div id="important-emails" class="summary-content" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Review Drafts Tab -->
        <div id="drafts" class="tab-content">
            <h2>Review Email Drafts</h2>
            <div id="drafts-list"></div>
        </div>

        <!-- Email Accounts Tab -->
        <div id="accounts" class="tab-content">
            <h2>Email Accounts</h2>
            <p class="help-text">Manage multiple email accounts for processing</p>
            
            <button onclick="showAccountForm()" class="btn btn-primary">Add Email Account</button>
            
            <div id="account-form" class="card" style="display: none; margin-top: 20px;">
                <h3 id="account-form-title">Add Email Account</h3>
                <div class="form-group">
                    <label>Account Name:</label>
                    <input type="text" id="account-name" placeholder="e.g., Work Gmail, Personal Yahoo">
                </div>
                <div class="form-group">
                    <label>Email Address:</label>
                    <input type="email" id="account-email">
                </div>
                <div class="form-group">
                    <label>Email Platform/Domain:</label>
                    <select id="imap-preset" onchange="applyIMAPPreset()">
                        <option value="gmail" selected>Gmail</option>
                        <option value="outlook">Outlook/Hotmail</option>
                        <option value="yahoo">Yahoo</option>
                        <option value="icloud">iCloud</option>
                        <option value="aol">AOL</option>
                        <option value="">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mail Server:</label>
                    <input type="text" id="account-imap-server" placeholder="imap.gmail.com">
                </div>
                <div class="form-group">
                    <label>Mail Server Port:</label>
                    <input type="number" id="account-imap-port" value="993" placeholder="993">
                </div>
                <div class="form-group">
                    <label>Password/App Password:</label>
                    <input type="password" id="account-password" placeholder="Your email password or app-specific password">
                    <small style="display: block; margin-top: 5px; color: #666;">Gmail users: Use an App Password (not your regular password)</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="account-active" checked> Active (process emails from this account)
                    </label>
                </div>
                <button onclick="saveAccount()" class="btn btn-primary">Save Account</button>
                <button onclick="hideAccountForm()" class="btn">Cancel</button>
            </div>

            <div id="accounts-list" style="margin-top: 20px;"></div>
        </div>

        <!-- Configuration Tab -->
        <div id="config" class="tab-content">
            <h2>Email Processing Configuration</h2>
            <p class="help-text">Configure priority-based email classification using the triage matrix</p>
            
            <!-- Priority Sub-Tabs -->
            <div class="sub-tabs">
                <button class="sub-tab-btn active" onclick="showPriorityTab('high')">High Priority</button>
                <button class="sub-tab-btn" onclick="showPriorityTab('important')">Important</button>
                <button class="sub-tab-btn" onclick="showPriorityTab('low')">Low Priority</button>
                <button class="sub-tab-btn" onclick="showPriorityTab('subscriptions')">Subscriptions</button>
            </div>

            <!-- High Priority Tab -->
            <div id="priority-high" class="priority-content active">
                <div class="card">
                    <h3>ðŸ”´ High Priority Senders</h3>
                    <p class="help-text">CEOs, VPs, key clients - highest priority processing</p>
                    <div id="whitelist-high-items"></div>
                    <div class="input-group">
                        <input type="text" id="whitelist-high-input" placeholder="ceo@company.com or @keyclient.com">
                        <button onclick="addPriorityConfig('whitelist', 'High Priority')" class="btn">Add Sender</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Subject Line Keywords</h3>
                    <p class="help-text">e.g., Deadline, Meeting invite, Status report, URGENT</p>
                    <div id="subject-high-items"></div>
                    <div class="input-group">
                        <input type="text" id="subject-high-input" placeholder="Deadline, Meeting, Urgent">
                        <button onclick="addPriorityConfig('subject_keyword', 'High Priority')" class="btn">Add Keyword</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Body Content Keywords</h3>
                    <p class="help-text">e.g., Critical, Urgent, Immediate action required</p>
                    <div id="body-high-items"></div>
                    <div class="input-group">
                        <input type="text" id="body-high-input" placeholder="Critical, Urgent, Immediate">
                        <button onclick="addPriorityConfig('body_keyword', 'High Priority')" class="btn">Add Keyword</button>
                    </div>
                </div>
            </div>

            <!-- Important Tab -->
            <div id="priority-important" class="priority-content">
                <div class="card">
                    <h3>ðŸŸ¡ Important Senders</h3>
                    <p class="help-text">Internal colleagues, project team members - important processing</p>
                    <div id="whitelist-important-items"></div>
                    <div class="input-group">
                        <input type="text" id="whitelist-important-input" placeholder="colleague@company.com">
                        <button onclick="addPriorityConfig('whitelist', 'Important')" class="btn">Add Sender</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Subject Line Keywords</h3>
                    <p class="help-text">e.g., Minutes, Plan, Expense, Action Required</p>
                    <div id="subject-important-items"></div>
                    <div class="input-group">
                        <input type="text" id="subject-important-input" placeholder="Minutes, Plan, Expense">
                        <button onclick="addPriorityConfig('subject_keyword', 'Important')" class="btn">Add Keyword</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Body Content Keywords</h3>
                    <p class="help-text">e.g., Action plan, Please review, Task assignment</p>
                    <div id="body-important-items"></div>
                    <div class="input-group">
                        <input type="text" id="body-important-input" placeholder="Action plan, Please review">
                        <button onclick="addPriorityConfig('body_keyword', 'Important')" class="btn">Add Keyword</button>
                    </div>
                </div>
            </div>

            <!-- Low Priority Tab -->
            <div id="priority-low" class="priority-content">
                <div class="card">
                    <h3>ðŸŸ¢ Low Priority Senders</h3>
                    <p class="help-text">Subscriptions to maintain, newsletters - low priority processing</p>
                    <div id="whitelist-low-items"></div>
                    <div class="input-group">
                        <input type="text" id="whitelist-low-input" placeholder="newsletter@service.com">
                        <button onclick="addPriorityConfig('whitelist', 'Low Priority')" class="btn">Add Sender</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Subject Line Keywords</h3>
                    <p class="help-text">e.g., FYI, Newsletter, Update</p>
                    <div id="subject-low-items"></div>
                    <div class="input-group">
                        <input type="text" id="subject-low-input" placeholder="FYI, Newsletter">
                        <button onclick="addPriorityConfig('subject_keyword', 'Low Priority')" class="btn">Add Keyword</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Body Content Keywords</h3>
                    <p class="help-text">e.g., Unsubscribe, FYI, Optional</p>
                    <div id="body-low-items"></div>
                    <div class="input-group">
                        <input type="text" id="body-low-input" placeholder="Unsubscribe, FYI">
                        <button onclick="addPriorityConfig('body_keyword', 'Low Priority')" class="btn">Add Keyword</button>
                    </div>
                </div>
            </div>

            <!-- Subscriptions Whitelist Tab -->
            <div id="priority-subscriptions" class="priority-content">
                <div class="card">
                    <h3>ðŸ“§ Subscriptions Whitelist</h3>
                    <p class="help-text">Subscriptions to keep - newsletters and services you want to continue receiving</p>
                    <div id="subscriptions-items"></div>
                    <div class="input-group">
                        <input type="text" id="subscriptions-input" placeholder="newsletter@service.com or @updates.company.com">
                        <button onclick="addSubscription()" class="btn">Add Subscription</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions Tab -->
        <div id="actions" class="tab-content">
            <h2>Action Management</h2>
            <p class="help-text">Define automated actions and human-in-the-loop workflows with SLA tracking</p>
            
            <!-- Priority Sub-Tabs -->
            <div class="sub-tabs">
                <button class="sub-tab-btn active" onclick="showActionPriorityTab('high')">High Priority</button>
                <button class="sub-tab-btn" onclick="showActionPriorityTab('important')">Important</button>
                <button class="sub-tab-btn" onclick="showActionPriorityTab('low')">Low Priority</button>
            </div>

            <!-- High Priority Actions -->
            <div id="action-priority-high" class="priority-content active">
                <button onclick="showActionForm('High Priority')" class="btn btn-primary">Create Action</button>
                <div id="actions-high-list" style="margin-top: 20px;"></div>
            </div>

            <!-- Important Actions -->
            <div id="action-priority-important" class="priority-content">
                <button onclick="showActionForm('Important')" class="btn btn-primary">Create Action</button>
                <div id="actions-important-list" style="margin-top: 20px;"></div>
            </div>

            <!-- Low Priority Actions -->
            <div id="action-priority-low" class="priority-content">
                <button onclick="showActionForm('Low Priority')" class="btn btn-primary">Create Action</button>
                <div id="actions-low-list" style="margin-top: 20px;"></div>
            </div>

            <!-- Action Form (shared across all priorities) -->
            <div id="action-form" class="card" style="display: none; margin-top: 20px;">
                <h3 id="action-form-title">Create Action</h3>
                <div class="form-group">
                    <label>Action Name:</label>
                    <input type="text" id="action-name" placeholder="e.g., Auto-label urgent emails">
                </div>
                <div class="form-group">
                    <label>Priority:</label>
                    <select id="action-priority">
                        <option value="High Priority">High Priority</option>
                        <option value="Important">Important</option>
                        <option value="Low Priority">Low Priority</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Action Type:</label>
                    <select id="action-type">
                        <option value="auto">Auto (Automatic Execution)</option>
                        <option value="hitl">HITL (Human-in-the-Loop)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="action-description" rows="3" placeholder="Describe what this action does..."></textarea>
                </div>
                <div class="form-group">
                    <label>SLA Hours (for reporting):</label>
                    <input type="number" id="action-sla-hours" value="24" min="1" placeholder="24">
                    <small style="display: block; margin-top: 5px; color: #666;">Time-based tracking: 0-24hrs (Green), 24-48hrs (Amber), >48hrs (Red)</small>
                </div>
                <div class="form-group">
                    <label>Link to Templates:</label>
                    <div id="action-template-links"></div>
                </div>
                <button onclick="saveAction()" class="btn btn-primary">Save Action</button>
                <button onclick="hideActionForm()" class="btn">Cancel</button>
            </div>
        </div>

        <!-- Templates Tab -->
        <div id="templates" class="tab-content">
            <h2>Email Templates</h2>
            <button onclick="showTemplateForm()" class="btn btn-primary">Create New Template</button>
            
            <div id="template-form" class="card" style="display: none; margin-top: 20px;">
                <h3>Template Editor</h3>
                <div class="form-group">
                    <label>Template Name:</label>
                    <input type="text" id="template-name" placeholder="e.g., Sales Inquiry Response">
                </div>
                <div class="form-group">
                    <label>Priority:</label>
                    <select id="template-priority">
                        <option value="High Priority">High Priority</option>
                        <option value="Important" selected>Important</option>
                        <option value="Low Priority">Low Priority</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Category:</label>
                    <select id="template-category">
                        <option value="Sales Inquiry">Sales Inquiry</option>
                        <option value="Technical Support">Technical Support</option>
                        <option value="Invoice/Billing">Invoice/Billing</option>
                        <option value="HR Request">HR Request</option>
                        <option value="General Inquiry">General Inquiry</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subject Template (optional):</label>
                    <input type="text" id="template-subject" placeholder="Re: {original_subject}">
                </div>
                <div class="form-group">
                    <label>Body Template:</label>
                    <textarea id="template-body" rows="6" placeholder="Dear {customer_name},&#10;&#10;Thank you for your inquiry..."></textarea>
                </div>
                <button onclick="saveTemplate()" class="btn btn-primary">Save Template</button>
                <button onclick="hideTemplateForm()" class="btn">Cancel</button>
            </div>

            <div id="templates-list" style="margin-top: 20px;"></div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>Email Account Settings</h2>
            <div class="card">
                <p class="help-text">Configure your email account for monitoring incoming emails</p>
                
                <div class="form-group">
                    <label>Mail Server:</label>
                    <input type="text" id="setting-imap" placeholder="imap.gmail.com">
                    <small>Examples: imap.gmail.com, outlook.office365.com</small>
                </div>
                
                <div class="form-group">
                    <label>Email Address:</label>
                    <input type="email" id="setting-email" placeholder="your-email@example.com">
                </div>
                
                <div class="form-group">
                    <label>Email Password / App Password:</label>
                    <input type="password" id="setting-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    <small>For Gmail, use an App Password. Never use your main password.</small>
                </div>
                
                <button onclick="saveSettings()" class="btn btn-primary">Save Settings</button>
            </div>

            <div class="card">
                <h3>Gemini API Configuration</h3>
                <p class="help-text">Your Gemini API key is configured via environment variables (GEMINI_API_KEY)</p>
                <div id="gemini-status"></div>
            </div>

            <div class="card">
                <h3>Color Scheme</h3>
                <p class="help-text">Choose your preferred color theme</p>
                <div class="form-group">
                    <label>Theme:</label>
                    <select id="theme-selector" onchange="changeTheme()">
                        <option value="default">Purple (Default)</option>
                        <option value="dark">Dark Mode</option>
                        <option value="blue">Ocean Blue</option>
                        <option value="green">Nature Green</option>
                        <option value="red">Sunset Red</option>
                        <option value="yellow">Golden Yellow</option>
                        <option value="brown">Warm Brown</option>
                        <option value="orange">Vibrant Orange</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js?v=3.0"></script>
</body>
</html>
